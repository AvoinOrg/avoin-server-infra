http:
  routers:
    climate-map:
      rule: "Host(`{{env "DOMAIN"}}`) && PathPrefix(`/climate-map`)"
      service: climate-map
      middlewares:
        - climate-map-stripprefix
      tls:
        certResolver: myresolver
    zitadel:
      rule: "Host(`auth.{{env "DOMAIN"}}`)"
      service: zitadel
      # middlewares:
      #   - auth-stripprefix
      tls:
        certResolver: myresolver
        # domains:
        #   - main: "auth.server.avoin.org"
    data:
      rule: "Host(`{{env "DOMAIN"}}`) && PathPrefix(`/data`)"
      service: data
      middlewares:
        - data-headers
        - data-stripprefix
      tls:
        certResolver: myresolver

  services:
    climate-map:
      loadBalancer:
        servers:
          - url: "{{env "CLIMATE_MAP_URL"}}"
    zitadel:
      loadBalancer:
        servers:
          - url: "{{env "AUTH_URL"}}"
    data:
      loadBalancer:
        servers:
        # CHANGE CORRECT URL HERE
          - url: "https://{{env "DATA_URL"}}"

  middlewares:
    data-headers:
      headers:
        customRequestHeaders:
        # CHANGE CORRECT DOMAIN HERE
          Host: "{{env "DATA_URL"}}"
        customResponseHeaders:
          x-amz-id-2: ""
          x-amz-request-id: ""
          Set-Cookie: ""
    data-stripprefix:
      stripPrefix:
        prefixes:
          - "/data"
    climate-map-stripprefix:
      stripPrefix:
        prefixes:
          - "/climate-map"
    # auth-stripprefix:
    #   stripPrefix:
    #     prefixes:
    #       - "/auth"
